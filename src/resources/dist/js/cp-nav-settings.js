!function($){void 0===Craft.CpNav&&(Craft.CpNav={});var t=new Craft.AdminTable({tableSelector:"#layoutItems",sortable:!0,reorderAction:"cp-nav/layout/reorder",deleteAction:"cp-nav/layout/delete",confirmDeleteMessage:Craft.t("cp-nav","Are you sure you want to permanently delete this layout and all its settings? This cannot be undone.")});$(document).on("click","tr.layout-item a.edit-layout",(function(t){new Craft.CpNav.EditLayoutItem($(this),$(this).parents("tr.layout-item"))})),Craft.CpNav.EditLayoutItem=Garnish.Base.extend({$element:null,data:null,layoutId:null,$form:null,hud:null,init:function(t,e){this.$element=t,this.data={id:e.data("id")},this.$element.addClass("loading"),this.$spinner=$('<div class="spinner small" />'),this.$element.append(this.$spinner),Craft.sendActionRequest("POST","cp-nav/layout/get-hud-html",{data:this.data}).then((t=>{this.showHud(t)}))},showHud:function(t){this.$element.removeClass("loading");var e=$();this.$spinner.remove(),this.$form=$("<div/>"),$fieldsContainer=$('<div class="fields"/>').appendTo(this.$form),$fieldsContainer.html(t.data.html),Craft.initUiElements($fieldsContainer);var a=$('<div class="hud-footer"/>').appendTo(this.$form),s=$('<div class="buttons right"/>').appendTo(a);this.$cancelBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Cancel")}).appendTo(s),this.$saveBtn=Craft.ui.createSubmitButton({label:Craft.t("app","Save"),spinner:!0}).appendTo(s),e=e.add(this.$form),this.hud=new Garnish.HUD(this.$element,e,{bodyClass:"body",closeOtherHUDs:!1}),this.hud.on("hide",$.proxy(this,"closeHud")),Garnish.$bod.append(t.data.footerJs),this.$form.find("input:first").focus(),this.addListener(this.$saveBtn,"click","save"),this.addListener(this.$cancelBtn,"click","closeHud")},save:function(t){t.preventDefault(),this.$saveBtn.addClass("loading");var e=this.hud.$body.serialize();Craft.sendActionRequest("POST","cp-nav/layout/save",{data:e}).then((t=>{this.$element.html("<strong>"+t.data.layout.name+"</strong>"),this.closeHud(),Craft.cp.displayNotice(t.data.message)})).catch((({response:t})=>{Garnish.shake(this.hud.$hud),t&&t.data&&t.data.message?Craft.cp.displayError(t.data.message):Craft.cp.displayError()})).finally((()=>{this.$saveBtn.removeClass("loading")}))},closeHud:function(){this.hud.$shade.remove(),this.hud.$hud.remove()}}),$(document).on("click",".add-new-layout",(function(t){t.preventDefault(),new Craft.CpNav.CreateLayoutItem($(this))})),Craft.CpNav.CreateLayoutItem=Garnish.Base.extend({$element:null,data:null,layoutId:null,$form:null,hud:null,init:function(t){this.$element=t,this.$element.addClass("loading"),Craft.sendActionRequest("POST","cp-nav/layout/get-hud-html",{}).then((t=>{this.showHud(t)}))},showHud:function(t){this.$element.removeClass("loading");var e=$();this.$form=$("<div/>"),$fieldsContainer=$('<div class="fields"/>').appendTo(this.$form),$fieldsContainer.html(t.data.html),Craft.initUiElements($fieldsContainer);var a=$('<div class="hud-footer"/>').appendTo(this.$form),s=$('<div class="buttons right"/>').appendTo(a);this.$cancelBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Cancel")}).appendTo(s),this.$saveBtn=Craft.ui.createSubmitButton({label:Craft.t("app","Save"),spinner:!0}).appendTo(s),e=e.add(this.$form),this.hud=new Garnish.HUD(this.$element,e,{bodyClass:"body",closeOtherHUDs:!1}),this.hud.on("hide",$.proxy(this,"closeHud")),Garnish.$bod.append(t.data.footerJs),this.$form.find("input:first").focus(),this.addListener(this.$saveBtn,"click","save"),this.addListener(this.$cancelBtn,"click","closeHud")},save:function(e){e.preventDefault(),this.$saveBtn.addClass("loading");var a=this.hud.$body.serialize();Craft.sendActionRequest("POST","cp-nav/layout/new",{data:a}).then((e=>{Craft.cp.displayNotice(e.data.message);var a=e.data.layout,s=t.addRow('<tr class="layout-item" data-id="'+a.id+'" data-name="'+a.name+'"><td><a class="edit-layout"><strong>'+a.name+'</strong></a></td><td class="thin"><a class="move icon" title="'+Craft.t("app","Reorder")+'" role="button"></a></td><td class="thin"><a class="delete icon" title="'+Craft.t("app","Delete")+'" role="button"></a></td></tr>');this.closeHud()})).catch((({response:t})=>{Garnish.shake(this.hud.$hud),t&&t.data&&t.data.message?Craft.cp.displayError(t.data.message):Craft.cp.displayError()})).finally((()=>{this.$saveBtn.removeClass("loading")}))},closeHud:function(){this.hud.$shade.remove(),this.hud.$hud.remove()}})}(jQuery),function($){void 0===Craft.CpNav&&(Craft.CpNav={}),$(document).on("change",".layout-select select",(function(){$(this).addClass("loading"),window.location.href=Craft.getUrl("cp-nav?layoutId="+$(this).val())})),$(document).on("click",".add-new-menu-item",(function(t){var e={layoutId:$('[name="layoutId"]').val(),type:$(this).data("type")};new Craft.CpNav.AddMenuItem($(".btn.submit.add-new-menu-item"),e)}));var t=$(".cp-nav-notice");t.length&&(t.remove(),$("#global-sidebar .global-sidebar__nav").prepend(t),t.addClass("shown")),Craft.CpNav.AddMenuItem=Garnish.Base.extend({$element:null,navId:null,$form:null,$cancelBtn:null,$saveBtn:null,hud:null,init:function(t,e){this.$element=t,this.$element.addClass("loading"),Craft.sendActionRequest("POST","cp-nav/navigation/get-hud-html",{data:e}).then((t=>{this.showHud(t)}))},showHud:function(t){this.$element.removeClass("loading");var e=$();this.$form=$("<div/>"),$fieldsContainer=$("<div/>").appendTo(this.$form),$fieldsContainer.html(t.data.bodyHtml),Craft.initUiElements($fieldsContainer);var a=$('<div class="hud-footer"/>').appendTo(this.$form),s=$('<div class="buttons right"/>').appendTo(a);this.$cancelBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Cancel")}).appendTo(s),this.$saveBtn=Craft.ui.createSubmitButton({label:Craft.t("app","Save"),spinner:!0}).appendTo(s),e=e.add(this.$form),this.hud=new Garnish.HUD(this.$element,e,{bodyClass:"body",closeOtherHUDs:!1}),this.hud.on("hide",$.proxy(this,"closeHud")),new Craft.HandleGenerator("#currLabel","#handle"),Garnish.$bod.append(t.data.footHtml),this.$form.find("input:first").focus(),this.addListener(this.$saveBtn,"click","saveGroupField"),this.addListener(this.$cancelBtn,"click","closeHud")},saveGroupField:function(t){t.preventDefault(),this.$saveBtn.addClass("loading");var e=this.hud.$body.serialize();Craft.sendActionRequest("POST","cp-nav/navigation/new",{data:e}).then((t=>{this.closeHud(),Craft.cp.displayNotice(t.data.message),this.addNavItem(t.data.navigation),a(t.data.navHtml)})).catch((({response:t})=>{Garnish.shake(this.hud.$hud),t&&t.data&&t.data.message?Craft.cp.displayError(t.data.message):Craft.cp.displayError()})).finally((()=>{this.$saveBtn.removeClass("loading")}))},closeHud:function(){this.hud.$shade.remove(),this.hud.$hud.remove()},addNavItem:function(t){var a=$(`<tr class="cp-nav-item" data-id="${t.id}" data-name="${t.currLabel}" data-level="${t.level}" tabindex="0">\n            <td class="thin lightswitch-cell">\n                <div class="field lightswitch-field">\n                    <div class="input ltr">\n                        <button type="button" class="lightswitch on small" role="checkbox" aria-checked="true">\n                            <div class="lightswitch-container">\n                                <div class="handle"></div>\n                            </div>\n                            <input type="hidden" name="navEnabled" value="1">\n                        </button>\n                    </div>\n                </div>\n            </td>\n\n            <td data-title="${t.currLabel}" data-titlecell style="padding-left: 0px;">\n                <a class="move icon" title="${Craft.t("app","Reorder")}" aria-label="${Craft.t("app","Reorder")}" role="button"></a>\n                <span class="element">\n                    <a class="js-edit-nav">${Craft.t("app",t.currLabel?t.currLabel:"[none]")}</a>\n                    <span>${t.currLabel?`(${Craft.t("app",t.currLabel)})`:""}</span>\n                </td>\n            </td>\n            \n            <td>\n                <span class="original-nav-link">${t.url?t.url:""}</span>\n            </td>\n            \n            <td>\n                <div class="nav-type">\n                    <span class="nav-type-${t.type}">${t.type}</span>\n                </div>\n            </td>\n            \n            <td>\n                <a class="delete icon" title="${Craft.t("app","Delete")}" role="button"></a>\n            </td>\n        </tr>`);e.addItem(a),Craft.initUiElements(a)}}),$(document).on("change","#cp-nav-items .lightswitch",(function(){var t=$(this).parents("tr"),e,s={value:$(this).find("input:first").val()?1:0,id:t.data("id"),layoutId:$('[name="layoutId"]').val()};Craft.sendActionRequest("POST","cp-nav/navigation/toggle",{data:s}).then((t=>{Craft.cp.displayNotice(t.data.message),a(t.data.navHtml)})).catch((({response:t})=>{t&&t.data&&t.data.message?Craft.cp.displayError(t.data.message):Craft.cp.displayError()}))})),$(document).on("click","tr.cp-nav-item a.js-edit-nav",(function(t){new Craft.CpNav.EditNavItem($(this),$(this).parents("tr.cp-nav-item"))})),Craft.CpNav.EditNavItem=Garnish.Base.extend({$element:null,data:null,navId:null,$form:null,$cancelBtn:null,$saveBtn:null,hud:null,init:function(t,e){this.$element=t,this.data={id:e.data("id"),currLabel:e.data("currlabel"),layoutId:$('[name="layoutId"]').val()},this.$spinner=$('<div class="spinner small" />'),this.$element.parent().append(this.$spinner),Craft.sendActionRequest("POST","cp-nav/navigation/get-hud-html",{data:this.data}).then((t=>{this.showHud(t)}))},showHud:function(t){this.$element.removeClass("loading");var e=$();this.$spinner.remove(),this.$form=$("<div/>"),$fieldsContainer=$("<div/>").appendTo(this.$form),$fieldsContainer.html(t.data.bodyHtml),Craft.initUiElements($fieldsContainer);var a=$('<div class="hud-footer"/>').appendTo(this.$form),s=$('<div class="buttons right"/>').appendTo(a);this.$cancelBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Cancel")}).appendTo(s),this.$saveBtn=Craft.ui.createSubmitButton({label:Craft.t("app","Save"),spinner:!0}).appendTo(s),e=e.add(this.$form),this.hud=new Garnish.HUD(this.$element,e,{bodyClass:"body",closeOtherHUDs:!1}),this.hud.on("hide",$.proxy(this,"closeHud")),Garnish.$bod.append(t.data.footHtml),this.$form.find("input:first").focus(),this.addListener(this.$saveBtn,"click","saveGroupField"),this.addListener(this.$cancelBtn,"click","closeHud")},saveGroupField:function(t){t.preventDefault(),this.$saveBtn.addClass("loading");var e=this.hud.$body.serialize();Craft.sendActionRequest("POST","cp-nav/navigation/save",{data:e}).then((t=>{this.$element.html(t.data.navigation.currLabel),this.closeHud(),Craft.cp.displayNotice(t.data.message),a(t.data.navHtml)})).catch((({response:t})=>{Garnish.shake(this.hud.$hud),t&&t.data&&t.data.message?Craft.cp.displayError(t.data.message):Craft.cp.displayError()})).finally((()=>{this.$saveBtn.removeClass("loading")}))},closeHud:function(){this.hud.$shade.remove(),this.hud.$hud.remove()}}),$(document).on("click","tr.cp-nav-item a.delete",(function(t){var s=$(this).parents("tr.cp-nav-item"),n={id:s.data("id"),layoutId:$('[name="layoutId"]').val()},i=Craft.t("app","Are you sure you want to delete “{name}”?",{name:s.data("name")});confirm(i)&&Craft.sendActionRequest("POST","cp-nav/navigation/delete",{data:n}).then((t=>{Craft.cp.displayNotice(t.data.message),e.removeItem(s),a(t.data.navHtml)})).catch((({response:t})=>{t&&t.data&&t.data.message?Craft.cp.displayError(t.data.message):Craft.cp.displayError()}))})),Craft.CpNav.NavAdminTable=Garnish.DragSort.extend({maxLevels:null,_basePadding:null,_helperMargin:null,_$firstRowCells:null,_$titleHelperCell:null,_titleHelperCellOuterWidth:null,_ancestors:null,_updateAncestorsFrame:null,_draggeeLevel:null,_draggeeLevelDelta:null,_targetLevel:null,_targetLevelBounds:null,_positionChanged:null,init:function(t){this.$container=$(t),this.$table=this.$container.find("table:first"),this.$elementContainer=this.$table.children("tbody:first"),this.maxLevels=parseInt(this.$table.attr("data-max-levels")),this._basePadding=12,this._helperMargin=50,settings=$.extend({},Craft.CpNav.NavAdminTable.defaults,{handle:".move",collapseDraggees:!0,singleHelper:!0,helperSpacingY:2,magnetStrength:4,helper:this.getHelper.bind(this),helperLagBase:1.5,axis:Garnish.Y_AXIS}),this.base(this.getElements(),settings)},getElements:function(){return this.$elementContainer.children()},addItem:function(t){this.$elementContainer.append(t),this.addItems(t)},removeItem:function(t){for(var e=t.next();e.length;){var a;if(e.data("level")<2)break;e.data("level",1),e.find("[data-titlecell]").css("padding-"+Craft.left,0),e=e.next()}t.remove(),this.removeItems(t)},findDraggee:function(){this._draggeeLevel=this._targetLevel=this.$targetItem.data("level"),this._draggeeLevelDelta=0;for(var t=$(this.$targetItem),e=this.$targetItem.next();e.length;){var a=e.data("level");if(a<=this._draggeeLevel)break;var s=a-this._draggeeLevel;s>this._draggeeLevelDelta&&(this._draggeeLevelDelta=s),t=t.add(e),e=e.next()}return t},getHelper:function(t){var e=$('<div class="datatablesorthelper"/>').appendTo(Garnish.$bod),a=$('<table class="data"/>').appendTo(e),s=$("<tbody/>").appendTo(a);t.appendTo(s),this._$firstRowCells=this.$elementContainer.children("tr:first").children();for(var n=t.children(),i=0;i<n.length;i++){var d=$(n[i]);if(d.hasClass("lightswitch-cell"))d.remove();else{var l=$(this._$firstRowCells[i]),r=l[0].getBoundingClientRect().width;if(l.css("width",r+"px"),d.css("width",r+"px"),Garnish.hasAttr(l,"data-titlecell")){this._$titleHelperCell=d;var o=parseInt(l.css("padding-"+Craft.left));this._titleHelperCellOuterWidth=r,d.css("padding-"+Craft.left,this._basePadding)}}}return e},canInsertBefore:function(t){return!1!==this._getLevelBounds(t.prev(),t)},canInsertAfter:function(t){return!1!==this._getLevelBounds(t,t.next())},onDragStart:function(){this._ancestors=this._getAncestors(this.$targetItem,this.$targetItem.data("level")),this._setTargetLevelBounds(),this.base()},onDrag:function(){this.base(),this._updateIndent()},onInsertionPointChange:function(){this._setTargetLevelBounds(),this._updateAncestorsBeforeRepaint(),this.base()},onDragStop:function(){if(this._positionChanged=!1,this.base(),this._targetLevel!=this._draggeeLevel){for(var t=this._targetLevel-this._draggeeLevel,e=0;e<this.$draggee.length;e++){var s=$(this.$draggee[e]),n,i=s.data("level")+t,d=this._getLevelIndent(i);s.data("level",i),s.children("[data-titlecell]:first").css("padding-"+Craft.left,d)}this._positionChanged=!0}if(this._positionChanged){for(var l={layoutId:$('[name="layoutId"]').val(),items:[]},r=this.getElements(),o=null,e=0;e<r.length;e++){var h=$(r[e]),u=$(r[e-1]);u.length&&(u.data("level")<h.data("level")&&(o=u.data("id")),u.data("level")>h.data("level")&&(o=null)),l.items.push({id:h.data("id"),level:h.data("level"),parentId:o})}Craft.sendActionRequest("POST","cp-nav/navigation/reorder",{data:l}).then((t=>{Craft.cp.displayNotice(t.data.message),a(t.data.navHtml)})).catch((({response:t})=>{t&&t.data&&t.data.message?Craft.cp.displayError(t.data.message):Craft.cp.displayError()}))}},onSortChange:function(){this._positionChanged=!0,this.base()},_getLevelBounds:function(t,e){if(e&&e.length?this._getLevelBounds._minLevel=e.data("level"):this._getLevelBounds._minLevel=1,t&&t.length?this._getLevelBounds._maxLevel=t.data("level")+1:this._getLevelBounds._maxLevel=1,this.maxLevels){if(1!=this._getLevelBounds._minLevel&&this._getLevelBounds._minLevel+this._draggeeLevelDelta>this.maxLevels)return!1;this._getLevelBounds._maxLevel+this._draggeeLevelDelta>this.maxLevels&&(this._getLevelBounds._maxLevel=this.maxLevels-this._draggeeLevelDelta,this._getLevelBounds._maxLevel<this._getLevelBounds._minLevel&&(this._getLevelBounds._maxLevel=this._getLevelBounds._minLevel))}return{min:this._getLevelBounds._minLevel,max:this._getLevelBounds._maxLevel}},_setTargetLevelBounds:function(){this._targetLevelBounds=this._getLevelBounds(this.$draggee.first().prev(),this.$draggee.last().next())},_updateIndent:function(t){this._updateIndent._mouseDist=this.realMouseX-this.mousedownX,"rtl"===Craft.orientation&&(this._updateIndent._mouseDist*=-1),this._updateIndent._indentationDist=Math.round(this._updateIndent._mouseDist/Craft.CpNav.NavAdminTable.LEVEL_INDENT),this._updateIndent._targetLevel=this._draggeeLevel+this._updateIndent._indentationDist,this._updateIndent._targetLevel<this._targetLevelBounds.min?(this._updateIndent._indentationDist+=this._targetLevelBounds.min-this._updateIndent._targetLevel,this._updateIndent._targetLevel=this._targetLevelBounds.min):this._updateIndent._targetLevel>this._targetLevelBounds.max&&(this._updateIndent._indentationDist-=this._updateIndent._targetLevel-this._targetLevelBounds.max,this._updateIndent._targetLevel=this._targetLevelBounds.max),this._targetLevel!==(this._targetLevel=this._updateIndent._targetLevel)&&this._updateAncestorsBeforeRepaint(),this._updateIndent._targetLevelMouseDiff=this._updateIndent._mouseDist-this._updateIndent._indentationDist*Craft.CpNav.NavAdminTable.LEVEL_INDENT,this._updateIndent._magnetImpact=Math.round(this._updateIndent._targetLevelMouseDiff/15),Math.abs(this._updateIndent._magnetImpact)>Craft.CpNav.NavAdminTable.MAX_GIVE&&(this._updateIndent._magnetImpact=(this._updateIndent._magnetImpact>0?1:-1)*Craft.CpNav.NavAdminTable.MAX_GIVE),this._updateIndent._closestLevelMagnetIndent=this._getLevelIndent(this._targetLevel)+this._updateIndent._magnetImpact,this.helpers[0].css("margin-"+Craft.left,this._updateIndent._closestLevelMagnetIndent+this._helperMargin),this._$titleHelperCell.css("width",this._titleHelperCellOuterWidth-this._updateIndent._closestLevelMagnetIndent)},_getLevelIndent:function(t){return(t-1)*Craft.CpNav.NavAdminTable.LEVEL_INDENT},_getAncestors:function(t,e){if(this._getAncestors._ancestors=[],0!=e)for(this._getAncestors._level=e,this._getAncestors._$prevRow=t.prev();this._getAncestors._$prevRow.length&&!(this._getAncestors._$prevRow.data("level")<this._getAncestors._level&&(this._getAncestors._ancestors.unshift(this._getAncestors._$prevRow),this._getAncestors._level=this._getAncestors._$prevRow.data("level"),0==this._getAncestors._level));)this._getAncestors._$prevRow=this._getAncestors._$prevRow.prev();return this._getAncestors._ancestors},_updateAncestorsBeforeRepaint:function(){this._updateAncestorsFrame&&Garnish.cancelAnimationFrame(this._updateAncestorsFrame),this._updateAncestorsFrame=Garnish.requestAnimationFrame(this._updateAncestors.bind(this))},_updateAncestors:function(){for(this._updateAncestorsFrame=null,this._updateAncestors._i=0;this._updateAncestors._i<this._ancestors.length;this._updateAncestors._i++)this._updateAncestors._$ancestor=this._ancestors[this._updateAncestors._i],this._updateAncestors._$ancestor.data("descendants",this._updateAncestors._$ancestor.data("descendants")-1);for(this._updateAncestors._newAncestors=this._getAncestors(this.$targetItem,this._targetLevel),this._updateAncestors._i=0;this._updateAncestors._i<this._updateAncestors._newAncestors.length;this._updateAncestors._i++)this._updateAncestors._$ancestor=this._updateAncestors._newAncestors[this._updateAncestors._i],this._updateAncestors._$ancestor.data("descendants",this._updateAncestors._$ancestor.data("descendants")+1);this._ancestors=this._updateAncestors._newAncestors,delete this._updateAncestors._i,delete this._updateAncestors._$ancestor,delete this._updateAncestors._newAncestors}},{HELPER_MARGIN:0,LEVEL_INDENT:22,MAX_GIVE:22});var e=new Craft.CpNav.NavAdminTable("#cp-nav-items"),a=function(t){$("#global-sidebar nav#nav").html(t),new Craft.CpNav.InitMenuItems}}(jQuery),$((function(){}));
//# sourceMappingURL=cp-nav-settings.js.map